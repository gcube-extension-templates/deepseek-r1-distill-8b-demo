#!/bin/bash
# ==============================================
#  DeepSeek-R1-Distill-Llama-8B â€” Setup Script
#  ì‹¤í–‰: bash setup.sh
# ==============================================

set -e  # ì˜¤ë¥˜ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¤‘ë‹¨

echo "======================================"
echo "  ğŸ§  DeepSeek-R1-Distill-Llama-8B Setup"
echo "======================================"

# ----------------------------------------------
# 1. íŒ¨í‚¤ì§€ ì„¤ì¹˜
# ----------------------------------------------
echo ""
echo "[1/2] íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
pip install -r requirements.txt --quiet
echo "âœ… íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ"

# ----------------------------------------------
# 2. ëª¨ë¸ ë‹¤ìš´ë¡œë“œ
# (MIT ë¼ì´ì„ ìŠ¤ â€” HF ë¡œê·¸ì¸ ë¶ˆí•„ìš”)
# ----------------------------------------------
echo ""
echo "[2/2] ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì¤‘... (ì•½ 16GB, ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤)"

MODEL_DIR="/workspace/models/deepseek-r1-distill-llama-8b"
mkdir -p "$MODEL_DIR"

if ! huggingface-cli download deepseek-ai/DeepSeek-R1-Distill-Llama-8B \
    --local-dir "$MODEL_DIR"; then
    echo ""
    echo "âŒ ëª¨ë¸ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
    echo "   ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹¤í–‰í•´ì£¼ì„¸ìš”."
    exit 1
fi

echo "âœ… ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: $MODEL_DIR"

# ----------------------------------------------
# ì™„ë£Œ
# ----------------------------------------------
echo ""
echo "======================================"
echo "  âœ… Setup ì™„ë£Œ!"
echo "  ì´ì œ ì•„ë˜ ëª…ë ¹ì–´ë¡œ ì‹¤í–‰í•˜ì„¸ìš”:"
echo ""
echo "  python run.py"
echo "======================================"